import{_ as $}from"./AuthenticatedLayout.vue_vue_type_script_setup_true_lang-kHMKfb8y.js";import{d as N,l as c,q as U,s as E,i as b,x as T,g as S,a as l,u as x,w as r,F as w,m as i,o as h,Z as F,e as y,V as G,b as Z,y as H,D as R,c as j}from"./app-DytueWss.js";import{e as q,E as K}from"./index-TAS4Brv2.js";import{u as z}from"./index-C6yPuO0v.js";import"./ApplicationLogo-DfeHetEq.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"d-flex flex-wrap gap-3"};Array.prototype.groupBy=function(m){return Object.entries(this.reduce(function(s,d){return(s[m(d)]=s[m(d)]||[]).push(d),s},{})).map(([s,d])=>({key:s,items:d}))};const ae=N({__name:"Logs",props:{dataLogs:{}},setup(m){const s=z("interval",0);clearInterval(s.value),window.echarts=q;const d=m,p=c(10),f=c(null),v=c(1e3);U([p,f,v],()=>{R.reload({data:{dataPointInterval:p.value,endDate:f.value,numberOfDataPoints:v.value}})});const{dataLogs:I}=E(d),M=[{name:"temperature_SHT35",unit:"C°",color:"rgb(255, 0,0)"},{name:"temperature_BMP390",unit:"C°",color:"rgb(210, 100, 0)"},{name:"humidity",unit:"%",color:"rgb(0,127,0)"},{name:"pressure",unit:"hPa",color:"rgb(0,180,140)"},{name:"VPD",unit:"KPa",color:"rgb(255, 0, 255)"}],A=b(()=>I.value.sort((e,a)=>e.created_at>a.created_at?1:-1).groupBy(e=>e.created_at.substring(0,16))),V=c(M.map(e=>({...e,checked:!0}))),_=b(()=>V.value.filter(e=>e.checked));function D(e,a,t="round",o=e){const g=10**(Math.floor(Math.log10(o))-a+1);return(Math[t](e/g)*g).toFixed(5)}const k=c(!0);T(()=>{k.value=!1});const B=b(()=>({tooltip:{trigger:"axis",position:function(e){return[e[0],"10%"]}},toolbox:{feature:{dataZoom:{yAxisIndex:"none"},restore:{},saveAsImage:{}}},...k.value?{dataZoom:[{type:"inside",start:90,end:100},{type:"slider"}]}:{},xAxis:{type:"time",boundaryGap:!1},yAxis:_.value.length>0?_.value.map(e=>e.name).map(e=>e.split("_")[0]).filter((e,a,t)=>t.indexOf(e)===a).map((e,a)=>({type:"value",boundaryGap:[0,"100%"],name:`${e.slice(0,4)}${e.length>4?".":""} (${{temperature:"°C",humidity:"%",pressure:"hPa",VPD:"kPa"}[e]})`,position:a%2==0?"left":"right",offset:Math.floor(a/2)*63,min:({min:t,max:o})=>D(t+(t-o)*.05,2,"floor",o-t),max:({min:t,max:o})=>D(o-(t-o)*.05,2,"ceil",o-t)})):{type:"value",boundaryGap:[0,"100%"],name:"None Selected"},series:_.value.map((e,a)=>({id:e.name,name:e.name,type:"line",symbol:"none",sampling:"lttb",itemStyle:{color:e.color},yAxisIndex:_.value.map(t=>t.name).map(t=>t.split("_")[0]).filter((t,o,u)=>u.indexOf(t)===o).findIndex(t=>t===e.name.split("_")[0]),data:A.value.map(t=>{const o=t.items.find(u=>u.type===e.name);return[new Date(t.key+":00").getTime(),o?o.value:null]})}))}));return(e,a)=>{const t=i("v-card-title"),o=i("v-select"),u=i("v-col"),g=i("v-row"),P=i("v-card-text"),C=i("v-checkbox"),L=i("v-card");return h(),S(w,null,[l(x(F),{title:"Logs"}),l($,null,{header:r(()=>[y("Logs")]),default:r(()=>[l(L,null,{default:r(()=>[l(t,null,{default:r(()=>[y("Settings")]),_:1}),l(P,null,{default:r(()=>[l(g,null,{default:r(()=>[l(u,{cols:"12",md:"4"},{default:r(()=>[l(o,{modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=n=>p.value=n),items:[{title:"1 Minute",value:1},{title:"10 Minutes",value:10},{title:"1 Hour",value:60}],label:"Interval between Data Points",outlined:""},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4",class:"dateInput"},{default:r(()=>[l(x(G),{modelValue:f.value,"onUpdate:modelValue":a[1]||(a[1]=n=>f.value=n),label:"End Date"},null,8,["modelValue"])]),_:1}),l(u,{cols:"12",md:"4"},{default:r(()=>[l(o,{modelValue:v.value,"onUpdate:modelValue":a[2]||(a[2]=n=>v.value=n),items:[1e3,5e3,1e4],label:"Number of Data Points",outlined:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(t,null,{default:r(()=>[y("Series")]),_:1}),l(P,null,{default:r(()=>[Z("div",J,[(h(!0),S(w,null,H(V.value,n=>(h(),j(C,{key:n.name,modelValue:n.checked,"onUpdate:modelValue":O=>n.checked=O,label:`${n.name} (${n.unit})`,color:n.color},null,8,["modelValue","onUpdate:modelValue","label","color"]))),128))])]),_:1}),l(x(K),{option:B.value,"update-options":{notMerge:!1,replaceMerge:["series","yAxis"]},style:{height:"600px"}},null,8,["option"])]),_:1})]),_:1})],64)}}});export{ae as default};
