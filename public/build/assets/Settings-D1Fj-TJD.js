import{d as $,J as X,H as Y,l as A,i as T,m,o as y,c as H,w as o,a as t,b as S,t as k,f as P,u as d,T as z,g as D,F as E,Z as G,e as V,h as R,y as j,K as J}from"./app-DytueWss.js";import{e as K,E as O}from"./index-TAS4Brv2.js";import{V as U,_ as Z,a as q}from"./types-HOk9VeI4.js";import{_ as Q}from"./AuthenticatedLayout.vue_vue_type_script_setup_true_lang-kHMKfb8y.js";import{u as W}from"./index-C6yPuO0v.js";import"./ApplicationLogo-DfeHetEq.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ee={title:"Drag the points to edit the curve, left click to add points, right click to remove points."},L=$({__name:"CurveEditor",props:X({title:{}},{modelValue:{default:[]},modelModifiers:{}}),emits:["update:modelValue"],setup(w){window.echarts=K;const i=Y(w,"modelValue"),h=A(),c=A(null),v=e=>`${Math.floor(e)}:${String(Math.round(e%1*60)).padStart(2,"0")}`,F=T(()=>({xAxis:{type:"value",min:0,max:24,splitNumber:12},yAxis:{type:"value",min:0,max:100},series:[{type:"line",data:(i.value||[]).map(([e,l])=>({name:e+"|"+l,value:[e,l]})),smooth:!1,symbolSize:12,lineStyle:{color:"#42A5F5",width:2},itemStyle:{color:"#42A5F5"}}],tooltip:{trigger:"axis",formatter:e=>{const l=e[0];return`Time: ${v(l.data.value[0])}<br/>Power: ${l.data.value[1]}%`}}}));let x=[0,0];const b=e=>{x=[e.offsetX,e.offsetY];const r=h.value.convertFromPixel({seriesIndex:0},[e.offsetX,e.offsetY]),n=p(r);n!==null&&(c.value=n)},g=e=>{if(c.value=null,Math.hypot(x[0]-e.offsetX,x[1]-e.offsetY)<5){if(e.button===0){let n=h.value.convertFromPixel({seriesIndex:0},[e.offsetX,e.offsetY]);if(p(n)===null){const f=i.value.findIndex(([_])=>_>n[0]);i.value=[...i.value.slice(0,f),M(null,n),...i.value.slice(f)]}}else if(e.button===2){const n=h.value.convertFromPixel({seriesIndex:0},[e.offsetX,e.offsetY]),u=p(n);u!==null&&u!==0&&u!==i.value.length-1&&(i.value=i.value.filter((f,_)=>_!==u))}}},C=e=>{if(c.value!==null){const r=h.value.convertFromPixel({seriesIndex:0},[e.offsetX,e.offsetY]);i.value[c.value]=M(c.value,r)}};function M(e,l){let r=0,n=24,u=0,f=100;return e==0?n=0:e==i.value.length-1?r=24:e!==null&&(r=i.value[e-1][0],n=i.value[e+1][0]),[Math.min(Math.max(r,Math.round(l[0])),n),Math.min(Math.max(u,Math.round(l[1]/5)*5),f)]}const p=e=>{let l=null,r=1/0;return i.value.forEach(([n,u],f)=>{const _=Math.hypot((n-e[0])*4,u-e[1]);_<10&&_<r&&(r=_,l=f)}),l};return(e,l)=>{const r=m("v-card-title"),n=m("v-card-text"),u=m("v-card");return y(),H(u,null,{default:o(()=>[t(r,null,{default:o(()=>[S("div",ee,k(e.title),1)]),_:1}),t(n,null,{default:o(()=>[S("div",{onMousedown:P(b,["prevent"]),onMouseup:P(g,["prevent"]),onMousemove:P(C,["prevent"]),onContextmenu:l[0]||(l[0]=P(()=>{},["prevent"]))},[t(d(O),{ref_key:"chartRef",ref:h,option:F.value,style:{height:"250px","margin-top":"-50px","margin-bottom":"-50px"}},null,8,["option"])],32)]),_:1})]),_:1})}}}),te={class:"me-4"},oe={class:"d-flex justify-end"},ue=$({__name:"Settings",props:{schedule:{}},setup(w){var x,b;const i=W("interval",0);clearInterval(i.value);const h=w,c={ventFanPowerCurve:[[0,50],[24,50]],ventFanAngleSpeedCurve:[[0,50],[24,50]]},v=z({cycleLength:((x=h.schedule)==null?void 0:x.cycle_length)||107,items:((b=h.schedule)==null?void 0:b.items.map(g=>({...structuredClone(c),...g})))||[{label:"Early Veg.",start:0,color:"#a000e0",vpd:.6,lightHours:1,...structuredClone(c)},{label:"Veg.",start:10,color:"#0000b0",vpd:.6,lightHours:2,...structuredClone(c)},{label:"Bloom 1",start:30,color:"#00b0b0",vpd:1,lightHours:12,...structuredClone(c)},{label:"Bloom 2",start:60,color:"#30b000",vpd:1.4,lightHours:12,...structuredClone(c)},{label:"Bloom End",start:100,color:"#d09000",vpd:1.4,lightHours:8,...structuredClone(c)},{label:"End",start:105,color:"#c02000",vpd:1,lightHours:0,...structuredClone(c)}]});function F(){v.transform(g=>({cycle_length:g.cycleLength,items:g.items})).post(route("schedules.store"))}return(g,C)=>{const M=m("v-alert"),p=m("v-col"),e=m("v-row"),l=m("v-icon"),r=m("v-list-item"),n=m("v-select"),u=m("v-timeline-item"),f=m("v-timeline"),_=m("v-card"),B=m("v-btn");return y(),D(E,null,[t(d(G),{title:"Settings"}),t(Q,null,{header:o(()=>[V("Settings")]),default:o(()=>[d(v).recentlySuccessful?(y(),H(M,{key:0,type:"success",variant:"tonal",class:"mb-2",dismissible:""},{default:o(()=>[V("Schedule Saved")]),_:1})):R("",!0),t(e,null,{default:o(()=>[t(p,{cols:12},{default:o(()=>[t(d(U),{modelValue:d(v).cycleLength,"onUpdate:modelValue":C[0]||(C[0]=s=>d(v).cycleLength=s),label:"Cycle Length (days)",min:0,"hide-details":""},null,8,["modelValue"])]),_:1})]),_:1}),t(f,{side:"end",class:"px-8",style:{"grid-template-columns":"auto min-content 1fr"}},{default:o(()=>[(y(!0),D(E,null,j(d(v).items,(s,I)=>(y(),H(u,{"dot-color":s.color,size:"small"},{default:o(()=>[t(e,{class:"py-2 me-5"},{default:o(()=>[t(p,{cols:"12",md:"2",class:"d-flex align-center"},{default:o(()=>[S("strong",te,k(s.label),1)]),_:2},1024),t(p,{cols:"12",md:"10"},{default:o(()=>[t(e,null,{default:o(()=>[t(p,{cols:"12",md:"4"},{default:o(()=>[t(n,{modelValue:s.vpd,"onUpdate:modelValue":a=>s.vpd=a,itemProps:a=>({title:a.vpd_range,subtitle:a.description,value:""+a.median_vpd_value}),items:d(q),label:"VPD","hide-details":""},{item:o(({item:a,props:N})=>[t(r,J({ref_for:!0},N),{prepend:o(()=>[t(l,{color:a.raw.color},{default:o(()=>[V("mdi-circle")]),_:2},1032,["color"])]),_:2},1040)]),selection:o(({item:a})=>[t(l,{color:a.raw.color,class:"me-2"},{default:o(()=>[V("mdi-circle")]),_:2},1032,["color"]),V(" "+k(a.raw.vpd_range),1)]),_:2},1032,["modelValue","onUpdate:modelValue","itemProps","items"])]),_:2},1024),t(p,{cols:"12",md:"4"},{default:o(()=>[t(d(U),{disabled:I==0,modelValue:s.start,"onUpdate:modelValue":a=>s.start=a,label:"Start (days)",min:0},null,8,["disabled","modelValue","onUpdate:modelValue"])]),_:2},1024),t(p,{cols:"12",md:"4"},{default:o(()=>[t(d(U),{modelValue:s.lightHours,"onUpdate:modelValue":a=>s.lightHours=a,label:"Light Hours",min:0,max:24},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(p,{cols:"12",md:"6"},{default:o(()=>[t(L,{title:"Vent. Fan Power Curve",modelValue:s.ventFanPowerCurve,"onUpdate:modelValue":a=>s.ventFanPowerCurve=a},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(p,{cols:"12",md:"6"},{default:o(()=>[t(L,{title:"Vent. Fan Angle Speed Curve",modelValue:s.ventFanAngleSpeedCurve,"onUpdate:modelValue":a=>s.ventFanAngleSpeedCurve=a},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["dot-color"]))),256))]),_:1}),t(_,null,{default:o(()=>[t(Z,{"model-value":d(v).items.map(s=>({...s,value:s.start})),start:0,end:d(v).cycleLength,class:"m-5 ps-6"},null,8,["model-value","end"])]),_:1}),S("div",oe,[t(B,{loading:d(v).processing,color:"primary",class:"mt-4",onClick:F},{default:o(()=>[V("Save")]),_:1},8,["loading"])])]),_:1})],64)}}});export{ue as default};
